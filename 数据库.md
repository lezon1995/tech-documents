# MySQL数据库

## MySQL 中 InnoDB 支持的四种事务隔离级别

- `read uncommited` ：读未提交
- `read committed`：读已提交
- `repeatable read`：可重复读
- `serializable` ：串行化

## MySQL 中 ENUM 的用法

`ENUM` 是一个字符串对象，用于指定一组预定义的值，并可在创建表时使用

```sql
Create table size(name ENUM('Smail','Medium','Large');
```

## char、 varchar和nchar、nvarchar 的区别

当 `char`值被存储时，它们被用空格填充到特定长度，检索 CHAR 值时需删除尾随空格。

当 `varchar`值被存储时，存储长度就是实际内容长度。

`nchar`、`nvarchar` 表示的是使用**Unicode数据类型**的字符

因为英文字母可以只需要1个字节存储，汉字需要2个字节

所以为了方便，使用**Unicode数据类型**的字符存储，无论存储英文还是汉字都是用2个字节

## LIKE 和 REGEXP 操作有什么区别

- LIKE 使用模糊查询，关键字是`%`、`_`
- REGEXP 使用正则表达式查询

## 数据库的三范式

- 第一范式

  > 数据库表的**每一个字段都是不可分割**的。

- 第二范式

  > 数据库表中的**非主属性只依赖于主键**。

- 第三范式

  > 不存在非主属性对关键字的传递函数依赖关系。
  >
  > 白话解释：
  >
  > 不准存在数据冗余现象
  >
  > 比如有`订单表`和`用户表`
  >
  > `订单表`需要存储`用户表ID`，以方便订单表可以找到对应的用户的详细信息，用户姓名，地址，电话等等
  >
  > 假设`订单表`为了方便，不想通过`用户ID`去查询`用户姓名`，而直接存储了`用户姓名`
  >
  > 这就叫作数据冗余
  >
  > 因为`用户姓名`在`订单表`和`用户表`中都存储了一份
  >
  > PS：但是某些场景下确实会违反第三范式，因为这样做可以省去一次甚至多次查询，提高效率

## MyISAM与InnoDB区别

- InnoDB

  > MySQL5.7之后默认存储引擎
  >
  > 支持ACID事务
  >
  > 支持`表锁`和`行锁`
  >
  > 使用`行锁`可能会导致`死锁`
  >
  > 数据与索引同处于 `.ibd` 文件中，也称`聚簇索引`
  >
  > 读效率比`MyISAM`低

- MyISAM

  > 不支持事务
  >
  > 只支持`表锁`
  >
  > 数据处于 `.myd` 文件中
  >
  > 索引处于 `.myi` 文件中
  >
  > 是`非聚簇索引`
  >
  > 读效率高
  >
  > 由于使用`表锁`，所以写效率比较低

## MySQL 优化

- 数据类型优化

  - **避免使用 NULL**，NULL 需要特殊处理, 大多数时候应该使用 NOT NULL，或者使用一个特殊的值，如 0，-1 作为默认值
  - **仅可能使用更小的字段**，MySQL 从磁盘读取数据后是存储到内存中的，然后使用 cpu 周期和磁盘 I/O 读取它，这意味着越小的数据类型占用的空间越小

- 子查询优化

  永远使用`小结果集`驱动`大结果集`

- 索引优化

  - 最左前缀匹配原则

    > MySQL会一直向右匹配知道遇到范围查询（>、<、between、like）就停止匹配

  - `=`和`in`可以乱序

    > 比如`a=1 and b=2 and c=3`，建立（a，b，c）索引的时候可以任意顺序
    >
    > MySQL会自动优化索引成可识别的形式

  - 选择区分度较高的列作为索引

    > `区分度` = `count(distinct column)` / `count(*)`

  - 索引不要参加运算

    > 不要在查询的时候给索引列套上函数
    >
    > 比如`from_unixtime(create_time) = '2014-05-29'`
    >
    > 需要改成
    >
    > `create_time = unix_timestamp('2014-05-29')`

  - 尽量扩展索引，而不是创建新的索引

## 数据库备份命令

**必须要在未登录状态下**

- 导出整个数据库

  > mysqldump -u 用户名 -p 数据库名 > 导出的文件名

- 导出一个表

  > mysqldump -u 用户名 -p 数据库名 表名> 导出的文件名

- 导出一个数据库结构

  > mysqldump -u dbuser -p -d --add-drop-table dbname >d:/dbname_db.sql
  > -d 没有数据 --add-drop-table 在每个 create 语句之前增加一个 drop table